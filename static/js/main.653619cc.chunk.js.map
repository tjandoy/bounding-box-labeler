{"version":3,"sources":["utils/I18N/index.js","containers/View.jsx","containers/Editor.jsx","containers/ImageList.jsx","reducers.js","configureStore.js","index.js","actions.js","selectors.js","utils/generic.js","utils/localStore.js"],"names":["global","__webpack_require__","d","__webpack_exports__","messages","DEFAULT_LOCALE","getBrowserLocale","_en_json__WEBPACK_IMPORTED_MODULE_0__","_ja_json__WEBPACK_IMPORTED_MODULE_1__","_generic__WEBPACK_IMPORTED_MODULE_2__","en","enMessages","ja","jaMessages","languagesList","LOCALE_STORAGE_KEY","normalizeWithDefault","str","locale","toLowerCase","split","isLocalStorageAvailable","savedLocale","window","localStorage","getItem","navigator","languages","language","userLanguage","Container","styled","div","_templateObject","LeftChild","_templateObject2","RightChild","_templateObject3","View","props","_this","Object","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","call","state","warnBeforeNavigate","bind","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_4__","addEventListener","removeEventListener","e","files","some","f","boxes","length","preventDefault","returnValue","react__WEBPACK_IMPORTED_MODULE_7___default","a","createElement","_ImageList__WEBPACK_IMPORTED_MODULE_13__","_Editor__WEBPACK_IMPORTED_MODULE_12__","Component","hot","module","connect","filesSelector","RectShape","wrapShape","_ref","width","height","strokeWidth","scale","react__WEBPACK_IMPORTED_MODULE_9___default","Math","max","x","y","fill","stroke","arrayReplace","arr","index","item","concat","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_8__","slice","Array","isArray","to5","n","round","Outer","Toolbar","InnerContainer","_templateObject4","Overlay","svg","_templateObject5","OverlayLine","line","_templateObject6","Editor","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","vectorWidth","vectorHeight","constrainMove","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__","constrainResize","onShapeChange","onShapeDelete","newRect","shapeProps","_this$props","setImageBoxes","_this$props$selectedF","selectedFile","name","box","shapeIndex","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","event","_this$props2","_this$props2$selected","_ref2","_this$state","min","_ref3$movingCorner","_ref3","movingCorner","movingX","movingY","_this$state2","_this2","changeScale","ratio","setState","_this$state3","mouseX","mouseY","react_intl__WEBPACK_IMPORTED_MODULE_11__","id","_this$props3","_this$props3$selected","filename","imageSrc","objectURL","shapes","map","key","keyboardTransformMultiplier","onChange","onDelete","shapeId","String","type","onClick","sqrt","onMouseMove","cancelAnimationFrame","overlayRequest","clientX","clientY","_this2$overlayEl$getB","overlayEl","getBoundingClientRect","top","left","requestAnimationFrame","style","react_shape_editor__WEBPACK_IMPORTED_MODULE_12__","display","src","onLoad","_ref4","naturalWidth","naturalHeight","DrawPreviewComponent","onAddShape","_ref5","ref","el","x1","y1","x2","y2","defaultProps","mapDispatchToProps","actions","selectedFileSelector","Header","List","ul","ListItem","li","ItemButton","button","IgnoreButton","_templateObject7","ImageList","keyHandler","defaultPrevented","handled","advance","arguments","undefined","_this2$props","selectedFilename","selectFile","filenameList","selectedIndex","indexOf","nextSelectedFilename","_this3","addFiles","removeAllFiles","toggleIgnoreFile","multiple","accept","fileInput","target","disabled","FileSaver","saveAs","Blob","JSON","stringify","filter","ignore","exportResults","confirm","value","background","textDecoration","selectedFilenameSelector","DEFAULT_STATE","data","fileDict","ui","combineReducers","action","payload","lang","objectSpread","keys","initialState","middleware","thunk","createStore","rootReducer","composeWithDevTools","applyMiddleware","apply","savedFileDict","getSavedFileMeta","initStore","configureStore","addLocaleData","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_272__","ConnectedIntlProvider","IntlProvider","ReactDOM","render","react__WEBPACK_IMPORTED_MODULE_273___default","react_redux__WEBPACK_IMPORTED_MODULE_275__","store","defaultLocale","_containers_View__WEBPACK_IMPORTED_MODULE_280__","document","getElementById","SET_FILE_DICT","setFileDict","saveFileMeta","fileList","dispatch","getState","updatedFileDict","from","reduce","acc","file","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","URL","createObjectURL","SELECT_FILE","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","SWITCH_LANGUAGE","reselect__WEBPACK_IMPORTED_MODULE_0__","fileDictSelector","createSelector","test","setItem","removeItem","FILE_META_STORAGE_KEY","CURRENT_STORAGE_VERSION","savedFileMetaString","savedFileMeta","parse","version","fileMeta","err","_fileDict$filename","fileWithoutObjectURL","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__"],"mappings":"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","file":"static/js/main.653619cc.chunk.js","sourcesContent":["import enMessages from './en.json';\nimport jaMessages from './ja.json';\nimport { isLocalStorageAvailable } from '../generic';\n\nexport const getPhrases = lang => {\n  if (lang === 'en') {\n    return enMessages;\n  }\n  if (lang === 'ja') {\n    return jaMessages;\n  }\n  return null;\n};\n\nexport const messages = {\n  en: enMessages,\n  ja: jaMessages,\n};\n\nexport const languagesList = {\n  ja: '日本語',\n  en: 'English',\n};\n\nexport const DEFAULT_LOCALE = 'en';\nconst LOCALE_STORAGE_KEY = 'REMEMBER_LOCALE';\n\nexport function getBrowserLocale() {\n  const normalizeWithDefault = str => {\n    const locale = str.toLowerCase().split(/[_-]+/)[0];\n    if (locale in languagesList) {\n      return locale;\n    }\n\n    return DEFAULT_LOCALE;\n  };\n\n  if (isLocalStorageAvailable()) {\n    const savedLocale = global.window.localStorage.getItem(LOCALE_STORAGE_KEY);\n    if (savedLocale) {\n      return normalizeWithDefault(savedLocale);\n    }\n  }\n  if (typeof navigator !== 'undefined') {\n    if (navigator.languages && navigator.languages[0]) {\n      return normalizeWithDefault(navigator.languages[0]);\n    }\n\n    if (navigator.language) {\n      return normalizeWithDefault(navigator.language);\n    }\n    if (navigator.userLanguage) {\n      return normalizeWithDefault(navigator.userLanguage);\n    }\n  }\n\n  return DEFAULT_LOCALE;\n}\n\nexport function saveBrowserLocale(locale) {\n  if (isLocalStorageAvailable()) {\n    global.window.localStorage.setItem(LOCALE_STORAGE_KEY, locale);\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport { connect } from 'react-redux';\nimport { hot } from 'react-hot-loader';\nimport { filesSelector } from '../selectors';\nimport Editor from './Editor';\nimport ImageList from './ImageList';\n\nconst Container = styled.div`\n  display: relative;\n  min-height: 100vh;\n`;\nconst LeftChild = styled.div`\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 200px;\n  height: 100%;\n`;\nconst RightChild = styled.div`\n  padding-left: 200px;\n`;\n\nclass View extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {};\n\n    this.warnBeforeNavigate = this.warnBeforeNavigate.bind(this);\n  }\n\n  componentDidMount() {\n    window.addEventListener('beforeunload', this.warnBeforeNavigate);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('beforeunload', this.warnBeforeNavigate);\n  }\n\n  warnBeforeNavigate(e) {\n    const { files } = this.props;\n\n    // Warn before navigation if any boxes have been set\n    if (files.some(f => f.boxes && f.boxes.length > 0)) {\n      e.preventDefault();\n      e.returnValue = 'stop';\n    }\n  }\n\n  render() {\n    return (\n      <Container>\n        <LeftChild>\n          <ImageList />\n        </LeftChild>\n        <RightChild>\n          <Editor />\n        </RightChild>\n      </Container>\n    );\n  }\n}\n\nView.propTypes = {\n  files: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n};\n\nconst mapStateToProps = state => ({\n  files: filesSelector(state),\n});\n\nexport default hot(module)(connect(mapStateToProps)(View));\n","import React, { Component } from 'react';\nimport styled from 'styled-components';\nimport { FormattedMessage } from 'react-intl';\nimport PropTypes from 'prop-types';\nimport {\n  ShapeEditor,\n  ImageLayer,\n  DrawLayer,\n  wrapShape,\n} from 'react-shape-editor';\nimport { connect } from 'react-redux';\nimport { selectedFileSelector } from '../selectors';\nimport * as actions from '../actions';\n\nconst RectShape = wrapShape(({ width, height, scale }) => {\n  const strokeWidth = 2 / scale;\n  return (\n    <rect\n      width={Math.max(0, width - strokeWidth)}\n      height={Math.max(0, height - strokeWidth)}\n      x={strokeWidth / 2}\n      y={strokeWidth / 2}\n      fill=\"rgba(100,100,255,0.3)\"\n      stroke=\"rgba(100,100,255,1)\"\n      strokeWidth={strokeWidth}\n    />\n  );\n});\n\nconst MAX_FIT_SIZE = 500;\nconst MIN_SCALE = 0.05;\nconst MAX_SCALE = 4;\n\nfunction arrayReplace(arr, index, item) {\n  return [\n    ...arr.slice(0, index),\n    ...(Array.isArray(item) ? item : [item]),\n    ...arr.slice(index + 1),\n  ];\n}\nconst to5 = n => Math.round(n);\n\nconst Outer = styled.div`\n  display: flex;\n  height: 100vh;\n  flex-direction: column;\n`;\n\nconst Toolbar = styled.div`\n  flex: 0 1 auto;\n  border-bottom: solid gray 2px;\n  padding: 5px 10px;\n  background: #eaeaea;\n`;\n\nconst Container = styled.div`\n  text-align: center;\n  flex: 1 1 auto;\n  width: 100%;\n  overflow: auto;\n  background: #ffeaff;\n`;\n\nconst InnerContainer = styled.div`\n  position: relative;\n  margin: auto;\n`;\n\nconst Overlay = styled.svg`\n  width: 100%;\n  position: absolute;\n  pointer-events: none;\n  left: 0;\n  top: 0;\n  height: 100%;\n`;\n\nconst OverlayLine = styled.line`\n  stroke: rgba(0, 0, 0, 0.5);\n  stroke-width: 0.5px;\n  stroke-dasharray: 5, 15;\n`;\n\nclass Editor extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      scale: 0.75,\n      vectorWidth: 0,\n      vectorHeight: 0,\n    };\n\n    this.constrainMove = this.constrainMove.bind(this);\n    this.constrainResize = this.constrainResize.bind(this);\n    this.onShapeChange = this.onShapeChange.bind(this);\n    this.onShapeDelete = this.onShapeDelete.bind(this);\n  }\n\n  onShapeChange(newRect, shapeProps) {\n    const {\n      setImageBoxes,\n      selectedFile: { name, boxes },\n    } = this.props;\n    const box = boxes[shapeProps.shapeIndex];\n\n    setImageBoxes(\n      name,\n      arrayReplace(boxes, shapeProps.shapeIndex, {\n        ...box,\n        ...newRect,\n      })\n    );\n  }\n\n  onShapeDelete(event, shapeProps) {\n    const {\n      setImageBoxes,\n      selectedFile: { name, boxes },\n    } = this.props;\n\n    setImageBoxes(name, arrayReplace(boxes, shapeProps.shapeIndex, []));\n  }\n\n  constrainMove({ x, y, width, height }) {\n    const { vectorWidth, vectorHeight } = this.state;\n    return {\n      x: to5(Math.min(vectorWidth - width, Math.max(0, x))),\n      y: to5(Math.min(vectorHeight - height, Math.max(0, y))),\n    };\n  }\n\n  constrainResize({ movingCorner: { x: movingX, y: movingY } }) {\n    const { vectorWidth, vectorHeight } = this.state;\n    return {\n      x: to5(Math.min(vectorWidth, Math.max(0, movingX))),\n      y: to5(Math.min(vectorHeight, Math.max(0, movingY))),\n    };\n  }\n\n  render() {\n    const changeScale = ratio =>\n      this.setState(state => ({\n        scale: Math.max(MIN_SCALE, Math.min(MAX_SCALE, state.scale * ratio)),\n      }));\n    const { scale, vectorWidth, vectorHeight, mouseX, mouseY } = this.state;\n\n    if (!this.props.selectedFile) {\n      return <FormattedMessage id=\"editor.needsFile\" />;\n    }\n\n    const {\n      selectedFile: { boxes, name: filename, objectURL: imageSrc },\n      setImageBoxes,\n    } = this.props;\n\n    if (!imageSrc) {\n      return (\n        <span>\n          File cache has been lost due to reload. Please upload the file named\n          &quot;{filename}&quot;\n        </span>\n      );\n    }\n\n    const shapes = boxes.map((box, index) => {\n      const { width, height, x, y } = box;\n      return (\n        <RectShape\n          // eslint-disable-next-line react/no-array-index-key\n          key={index}\n          constrainMove={this.constrainMove}\n          constrainResize={this.constrainResize}\n          height={height}\n          keyboardTransformMultiplier={5}\n          onChange={this.onShapeChange}\n          onDelete={this.onShapeDelete}\n          shapeId={String(index)}\n          shapeIndex={index}\n          width={width}\n          x={x}\n          y={y}\n        />\n      );\n    });\n\n    return (\n      <Outer>\n        <Toolbar>\n          <button type=\"button\" onClick={() => changeScale(1 / Math.sqrt(2))}>\n            -\n          </button>\n          <button type=\"button\" onClick={() => changeScale(Math.sqrt(2))}>\n            +\n          </button>\n        </Toolbar>\n        <Container\n          onMouseMove={event => {\n            cancelAnimationFrame(this.overlayRequest);\n            const { clientX, clientY } = event;\n            const { top, left } = this.overlayEl.getBoundingClientRect();\n            this.overlayRequest = requestAnimationFrame(() => {\n              this.setState({ mouseX: clientX - left, mouseY: clientY - top });\n            });\n          }}\n        >\n          <InnerContainer style={{ width: vectorWidth * scale }}>\n            <ShapeEditor\n              scale={scale}\n              vectorWidth={vectorWidth}\n              vectorHeight={vectorHeight}\n              style={{ display: 'block' }}\n            >\n              <ImageLayer\n                src={imageSrc}\n                onLoad={({ naturalWidth, naturalHeight }) => {\n                  this.setState({\n                    vectorWidth: naturalWidth,\n                    vectorHeight: naturalHeight,\n                    scale: MAX_FIT_SIZE / Math.max(naturalWidth, naturalHeight),\n                  });\n                }}\n              />\n\n              <DrawLayer\n                constrainMove={this.constrainMove}\n                constrainResize={this.constrainResize}\n                DrawPreviewComponent={RectShape}\n                onAddShape={({ x, y, width, height }) => {\n                  setImageBoxes(filename, [...boxes, { x, y, width, height }]);\n                }}\n              />\n              {shapes}\n            </ShapeEditor>\n\n            <Overlay\n              ref={el => {\n                this.overlayEl = el;\n              }}\n            >\n              <OverlayLine x1={mouseX} y1={0} x2={mouseX} y2={10000} />\n              <OverlayLine x1={0} y1={mouseY} x2={10000} y2={mouseY} />\n            </Overlay>\n          </InnerContainer>\n        </Container>\n      </Outer>\n    );\n  }\n}\n\nEditor.propTypes = {\n  selectedFile: PropTypes.shape({\n    boxes: PropTypes.arrayOf(PropTypes.shape({})),\n  }),\n  setImageBoxes: PropTypes.func.isRequired,\n};\n\nEditor.defaultProps = {\n  selectedFile: null,\n};\n\nconst mapStateToProps = state => ({\n  selectedFile: selectedFileSelector(state),\n});\n\nconst mapDispatchToProps = {\n  setImageBoxes: actions.setImageBoxes,\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Editor);\n","import React, { Component } from 'react';\nimport styled from 'styled-components';\nimport PropTypes from 'prop-types';\nimport FileSaver from 'file-saver';\nimport { connect } from 'react-redux';\nimport * as actions from '../actions';\nimport { filesSelector, selectedFilenameSelector } from '../selectors';\n\nconst Outer = styled.div`\n  display: flex;\n  height: 100vh;\n  flex-direction: column;\n`;\n\nconst Header = styled.div`\n  flex: 0 1 auto;\n  border-bottom: solid gray 2px;\n  padding: 5px 10px;\n`;\n\nconst Container = styled.div`\n  text-align: center;\n  flex: 1 1 auto;\n  width: 100%;\n  overflow: auto;\n  background: #fff;\n`;\n\nconst List = styled.ul`\n  list-style: none;\n  margin: 0;\n  padding: 0;\n`;\n\nconst ListItem = styled.li`\n  text-align: center;\n  border-bottom: solid black 1px;\n  display: flex;\n`;\n\nconst ItemButton = styled.button`\n  background: none;\n  border: none;\n  height: 2rem;\n  flex: 1 1 auto;\n`;\n\nconst IgnoreButton = styled.button`\n  background: none;\n  border: none;\n  height: 2rem;\n  flex: 0 1 auto;\n`;\n\nconst exportResults = files => {\n  FileSaver.saveAs(\n    new Blob(\n      [\n        JSON.stringify(\n          files\n            .filter(f => !f.ignore)\n            .map(({ name, boxes }) => ({\n              filename: name,\n              boxes,\n            }))\n        ),\n      ],\n      { type: 'application/json;charset=utf-8' }\n    ),\n    'boxes.json'\n  );\n};\n\nclass ImageList extends Component {\n  constructor(props) {\n    super(props);\n\n    this.keyHandler = this.keyHandler.bind(this);\n  }\n\n  componentDidMount() {\n    window.addEventListener('keydown', this.keyHandler);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('keydown', this.keyHandler);\n  }\n\n  keyHandler(event) {\n    // If the keydown event has already been handled by some other custom\n    // handler, we abort here.\n    if (event.defaultPrevented) {\n      return;\n    }\n\n    let handled = true;\n\n    const advance = (n = 1) => {\n      const { files, selectedFilename, selectFile } = this.props;\n      const filenameList = files.map(f => f.name);\n      const selectedIndex = filenameList.indexOf(selectedFilename);\n\n      let nextSelectedFilename = filenameList[0] || null;\n      if (selectedIndex >= 0) {\n        nextSelectedFilename =\n          filenameList[\n            (filenameList.length + selectedIndex + n) % filenameList.length\n          ];\n      }\n\n      selectFile(nextSelectedFilename);\n    };\n\n    switch (event.key) {\n      case 'x':\n      case 'ArrowRight':\n      case 'ArrowDown':\n        advance(1);\n        break;\n      case 'z':\n      case 'ArrowLeft':\n      case 'ArrowUp':\n        advance(-1);\n        break;\n      default:\n        handled = false;\n    }\n\n    if (handled) {\n      event.preventDefault();\n    }\n  }\n\n  render() {\n    const {\n      files,\n      addFiles,\n      removeAllFiles,\n      selectFile,\n      selectedFilename,\n      toggleIgnoreFile,\n    } = this.props;\n\n    return (\n      <Outer>\n        <Header>\n          Images\n          <br />\n          <input\n            type=\"file\"\n            multiple\n            accept=\"image/*\"\n            ref={el => {\n              this.fileInput = el;\n            }}\n            onChange={event => {\n              if (!event.target.files || event.target.files.length < 1) {\n                return;\n              }\n\n              addFiles(event.target.files);\n            }}\n          />\n          <br />\n          <button\n            type=\"button\"\n            disabled={files.length < 1}\n            onClick={() => {\n              exportResults(files);\n            }}\n          >\n            Export\n          </button>\n          <button\n            type=\"button\"\n            disabled={files.length < 1}\n            onClick={() => {\n              if (\n                // eslint-disable-next-line no-alert\n                window.confirm(\n                  'Do you really want to delete all file metadata?'\n                )\n              ) {\n                removeAllFiles();\n                this.fileInput.value = '';\n              }\n            }}\n          >\n            Clear All\n          </button>\n        </Header>\n        <Container>\n          <List>\n            {files.map(({ name, boxes, ignore }) => {\n              let background = 'transparent';\n              if (ignore) {\n                background = 'gray';\n              } else if (name === selectedFilename) {\n                background = 'lightblue';\n              } else if (boxes.length > 0) {\n                background = 'lightgreen';\n              }\n\n              return (\n                <ListItem key={name} style={{ background }}>\n                  <ItemButton\n                    type=\"button\"\n                    style={{\n                      textDecoration: ignore ? 'line-through' : undefined,\n                    }}\n                    onClick={() => selectFile(name)}\n                  >\n                    {name}\n                  </ItemButton>\n                  <IgnoreButton\n                    type=\"button\"\n                    onClick={() => toggleIgnoreFile(name)}\n                  >\n                    ×\n                  </IgnoreButton>\n                </ListItem>\n              );\n            })}\n          </List>\n        </Container>\n      </Outer>\n    );\n  }\n}\n\nImageList.propTypes = {\n  addFiles: PropTypes.func.isRequired,\n  files: PropTypes.arrayOf(\n    PropTypes.shape({\n      name: PropTypes.string,\n      boxes: PropTypes.arrayOf(PropTypes.shape({})),\n    })\n  ).isRequired,\n  removeAllFiles: PropTypes.func.isRequired,\n  selectFile: PropTypes.func.isRequired,\n  selectedFilename: PropTypes.string,\n  toggleIgnoreFile: PropTypes.func.isRequired,\n};\nImageList.defaultProps = {\n  selectedFilename: null,\n};\n\nconst mapStateToProps = state => ({\n  files: filesSelector(state),\n  selectedFilename: selectedFilenameSelector(state),\n});\n\nconst mapDispatchToProps = {\n  addFiles: actions.addFiles,\n  removeAllFiles: actions.removeAllFiles,\n  selectFile: actions.selectFile,\n  toggleIgnoreFile: actions.toggleIgnoreFile,\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(ImageList);\n","import { combineReducers } from 'redux';\nimport * as actions from './actions';\n\nconst DEFAULT_STATE = {\n  locale: 'ja',\n  data: {\n    fileDict: {},\n  },\n  ui: {\n    selectedFilename: null,\n  },\n};\n\nfunction data(state = DEFAULT_STATE.data, action) {\n  switch (action.type) {\n    case actions.SET_FILE_DICT:\n      return {\n        ...state,\n        fileDict: action.payload,\n      };\n    default:\n      return state;\n  }\n}\n\nfunction ui(state = DEFAULT_STATE.ui, action) {\n  switch (action.type) {\n    case actions.SELECT_FILE:\n      return {\n        ...state,\n        selectedFilename: action.payload,\n      };\n    case actions.SET_FILE_DICT:\n      return {\n        ...state,\n        selectedFilename:\n          !state.selectedFilename && Object.keys(action.payload).length > 0\n            ? action.payload[Object.keys(action.payload)[0]].name\n            : state.selectedFilename,\n      };\n    default:\n      return state;\n  }\n}\n\nfunction locale(state = DEFAULT_STATE.locale, action) {\n  switch (action.type) {\n    case actions.SWITCH_LANGUAGE:\n      return action.payload.lang;\n    default:\n      return state;\n  }\n}\n\nexport default combineReducers({\n  locale,\n  data,\n  ui,\n});\n","import { createStore, applyMiddleware } from 'redux';\nimport thunk from 'redux-thunk';\nimport { composeWithDevTools } from 'redux-devtools-extension';\nimport rootReducer from './reducers';\n\nexport default function(initialState) {\n  const middleware = [thunk];\n\n  return createStore(\n    rootReducer,\n    initialState,\n    composeWithDevTools(applyMiddleware(...middleware))\n  );\n}\n","import 'core-js';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { connect, Provider } from 'react-redux';\nimport { addLocaleData, IntlProvider } from 'react-intl';\nimport en from 'react-intl/locale-data/en';\nimport ja from 'react-intl/locale-data/ja';\nimport configureStore from './configureStore';\nimport View from './containers/View';\nimport { DEFAULT_LOCALE, getBrowserLocale, messages } from './utils/I18N';\nimport { getSavedFileMeta } from './utils/localStore';\nimport './index.css';\n\nconst savedFileDict = getSavedFileMeta();\nconst initialState = {\n  locale: getBrowserLocale(),\n  data: { fileDict: getSavedFileMeta() },\n  ui: { selectedFilename: Object.keys(savedFileDict)[0] },\n};\nconst initStore = configureStore(initialState);\n\naddLocaleData([...en, ...ja]);\n\nconst ConnectedIntlProvider = connect(({ locale }) => ({\n  locale,\n  messages: messages[locale],\n}))(IntlProvider);\n\nfunction render() {\n  ReactDOM.render(\n    <Provider store={initStore}>\n      <ConnectedIntlProvider defaultLocale={DEFAULT_LOCALE}>\n        <View />\n      </ConnectedIntlProvider>\n    </Provider>,\n    global.document.getElementById('app')\n  );\n}\n\nrender();\n","import { saveFileMeta } from './utils/localStore';\n\nexport const SET_FILE_DICT = 'SET_FILE_DICT';\nconst setFileDict = fileDict => {\n  saveFileMeta(fileDict);\n\n  return {\n    type: SET_FILE_DICT,\n    payload: fileDict,\n  };\n};\n\nexport const ADD_FILES = 'ADD_FILES';\nexport const addFiles = fileList => (dispatch, getState) => {\n  const { fileDict } = getState().data;\n  const updatedFileDict = Array.from(fileList).reduce(\n    (acc, file) => {\n      if (!acc[file.name] || !acc[file.name].objectURL) {\n        acc[file.name] = {\n          name: file.name,\n          boxes: [],\n          ...(acc[file.name] || {}),\n          objectURL: URL.createObjectURL(file),\n        };\n      }\n      return acc;\n    },\n    { ...fileDict }\n  );\n\n  dispatch(setFileDict(updatedFileDict));\n};\n\nexport const SELECT_FILE = 'SELECT_FILE';\nexport const selectFile = filename => ({\n  type: SELECT_FILE,\n  payload: filename,\n});\n\nexport const setImageBoxes = (filename, boxes) => (dispatch, getState) => {\n  const { fileDict } = getState().data;\n\n  dispatch(\n    setFileDict({\n      ...fileDict,\n      [filename]: {\n        ...fileDict[filename],\n        boxes,\n      },\n    })\n  );\n};\n\nexport const toggleIgnoreFile = filename => (dispatch, getState) => {\n  const { fileDict } = getState().data;\n\n  dispatch(\n    setFileDict({\n      ...fileDict,\n      [filename]: {\n        ...fileDict[filename],\n        ignore: !fileDict[filename].ignore,\n      },\n    })\n  );\n};\n\nexport const removeAllFiles = () => setFileDict({});\n\nexport const SWITCH_LANGUAGE = 'SWITCH_LANGUAGE';\nexport const switchLanguage = lang => ({\n  type: SWITCH_LANGUAGE,\n  payload: { lang },\n});\n","import { createSelector } from 'reselect';\n\nconst fileDictSelector = state => state.data.fileDict;\nexport const selectedFilenameSelector = state => state.ui.selectedFilename;\n\nexport const filesSelector = createSelector(\n  fileDictSelector,\n  fileDict => Object.keys(fileDict).map(filename => fileDict[filename])\n);\n\nexport const selectedFileSelector = createSelector(\n  fileDictSelector,\n  selectedFilenameSelector,\n  (fileDict, selectedFilename) => fileDict[selectedFilename]\n);\n","export function isLocalStorageAvailable() {\n  if (typeof global.window === 'undefined') return false;\n\n  const test = '__storage_test__';\n  try {\n    global.window.localStorage.setItem(test, test);\n    global.window.localStorage.removeItem(test);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n","import { isLocalStorageAvailable } from './generic';\n\nconst FILE_META_STORAGE_KEY = 'FILE_META_STORAGE_KEY';\nconst CURRENT_STORAGE_VERSION = 1;\nexport function getSavedFileMeta() {\n  if (isLocalStorageAvailable()) {\n    const savedFileMetaString = window.localStorage.getItem(\n      FILE_META_STORAGE_KEY\n    );\n    if (savedFileMetaString) {\n      try {\n        const savedFileMeta = JSON.parse(savedFileMetaString);\n        if (savedFileMeta.version === CURRENT_STORAGE_VERSION) {\n          return savedFileMeta.fileMeta;\n        }\n      } catch (err) {\n        // Do nothing\n      }\n    }\n  }\n\n  return {};\n}\n\nexport function saveFileMeta(fileDict) {\n  if (isLocalStorageAvailable()) {\n    window.localStorage.setItem(\n      FILE_META_STORAGE_KEY,\n      JSON.stringify({\n        version: CURRENT_STORAGE_VERSION,\n        fileMeta: Object.keys(fileDict).reduce((acc, filename) => {\n          const { objectURL, ...fileWithoutObjectURL } = fileDict[filename];\n          acc[filename] = fileWithoutObjectURL;\n\n          return acc;\n        }, {}),\n      })\n    );\n  }\n}\n"],"sourceRoot":""}