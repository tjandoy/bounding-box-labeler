{"version":3,"sources":["utils/I18N/index.js","containers/View.jsx","containers/Editor.jsx","containers/ImageList.jsx","reducers.js","configureStore.js","index.js","actions.js","selectors.js","utils/generic.js","utils/localStore.js"],"names":["global","__webpack_require__","d","__webpack_exports__","messages","DEFAULT_LOCALE","getBrowserLocale","_en_json__WEBPACK_IMPORTED_MODULE_0__","_ja_json__WEBPACK_IMPORTED_MODULE_1__","_generic__WEBPACK_IMPORTED_MODULE_2__","en","enMessages","ja","jaMessages","languagesList","LOCALE_STORAGE_KEY","normalizeWithDefault","str","locale","toLowerCase","split","isLocalStorageAvailable","savedLocale","window","localStorage","getItem","navigator","languages","language","userLanguage","Container","styled","div","_templateObject","LeftChild","_templateObject2","RightChild","_templateObject3","View","props","_this","Object","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","call","state","warnBeforeNavigate","bind","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_4__","addEventListener","removeEventListener","e","files","some","f","boxes","length","preventDefault","returnValue","react__WEBPACK_IMPORTED_MODULE_7___default","a","createElement","_ImageList__WEBPACK_IMPORTED_MODULE_13__","_Editor__WEBPACK_IMPORTED_MODULE_12__","Component","hot","module","connect","filesSelector","RectShape","wrapShape","_ref","width","height","strokeWidth","scale","react__WEBPACK_IMPORTED_MODULE_9___default","Math","max","x","y","fill","stroke","arrayReplace","arr","index","item","concat","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_8__","slice","Array","isArray","to5","n","round","IssueWrapper","Outer","Toolbar","_templateObject4","InnerContainer","_templateObject5","Overlay","svg","_templateObject6","OverlayLine","line","_templateObject7","OverlayLineOutline","_templateObject8","Editor","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","vectorWidth","vectorHeight","constrainMove","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__","constrainResize","onShapeChange","onShapeDelete","newRect","shapeProps","_this$props","setImageBoxes","_this$props$selectedF","selectedFile","name","box","shapeIndex","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","event","_this$props2","_this$props2$selected","_ref2","_this$state","min","_ref3$movingCorner","_ref3","movingCorner","movingX","movingY","_this$state2","_this2","changeScale","ratio","setState","_this$state3","mouseX","mouseY","react_intl__WEBPACK_IMPORTED_MODULE_11__","id","_this$props3","_this$props3$selected","filename","imageSrc","objectURL","values","shapes","map","key","keyboardTransformMultiplier","onChange","onDelete","shapeId","String","type","onClick","sqrt","onMouseMove","cancelAnimationFrame","overlayRequest","clientX","clientY","_this2$overlayEl$getB","overlayEl","getBoundingClientRect","top","left","requestAnimationFrame","style","react_shape_editor__WEBPACK_IMPORTED_MODULE_12__","display","src","onLoad","_ref4","naturalWidth","naturalHeight","DrawPreviewComponent","onAddShape","_ref5","ref","el","x1","y1","x2","y2","defaultProps","mapDispatchToProps","actions","selectedFileSelector","Header","List","ul","ListItem","li","ItemButton","button","IgnoreButton","ImageList","keyHandler","defaultPrevented","handled","advance","arguments","undefined","_this2$props","selectedFilename","selectFile","filenameList","selectedIndex","indexOf","nextSelectedFilename","_this3","addFiles","removeAllFiles","toggleIgnoreFile","multiple","accept","fileInput","target","disabled","FileSaver","saveAs","Blob","JSON","stringify","filter","ignore","exportResults","confirm","value","background","textDecoration","selectedFilenameSelector","DEFAULT_STATE","data","fileDict","ui","combineReducers","action","payload","lang","objectSpread","keys","initialState","middleware","thunk","createStore","rootReducer","composeWithDevTools","applyMiddleware","apply","savedFileDict","getSavedFileMeta","initStore","configureStore","addLocaleData","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_272__","ConnectedIntlProvider","IntlProvider","ReactDOM","render","react__WEBPACK_IMPORTED_MODULE_273___default","react_redux__WEBPACK_IMPORTED_MODULE_275__","store","defaultLocale","_containers_View__WEBPACK_IMPORTED_MODULE_280__","document","getElementById","SET_FILE_DICT","setFileDict","saveFileMeta","fileList","dispatch","getState","updatedFileDict","from","reduce","acc","file","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","URL","createObjectURL","SELECT_FILE","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","SWITCH_LANGUAGE","reselect__WEBPACK_IMPORTED_MODULE_0__","fileDictSelector","createSelector","test","setItem","removeItem","FILE_META_STORAGE_KEY","CURRENT_STORAGE_VERSION","savedFileMetaString","savedFileMeta","parse","version","fileMeta","err","_fileDict$filename","fileWithoutObjectURL","_Users_crs_try_bounding_box_labeler_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__"],"mappings":"2FAAA,SAAAA,GAAAC,EAAAC,EAAAC,EAAA,sBAAAC,IAAAH,EAAAC,EAAAC,EAAA,sBAAAE,IAAAJ,EAAAC,EAAAC,EAAA,sBAAAG,IAAA,IAAAC,EAAAN,EAAA,KAAAO,EAAAP,EAAA,KAAAQ,EAAAR,EAAA,IAcaG,EAAW,CACtBM,GAAIC,EACJC,GAAIC,GAGOC,EAAgB,CAC3BF,GAAI,qBACJF,GAAI,WAGOL,EAAiB,KACxBU,EAAqB,kBAEpB,SAAST,IACd,IAAMU,EAAuB,SAAAC,GAC3B,IAAMC,EAASD,EAAIE,cAAcC,MAAM,SAAS,GAChD,OAAIF,KAAUJ,EACLI,EAGFb,GAGT,GAAIgB,cAA2B,CAC7B,IAAMC,EAActB,EAAOuB,OAAOC,aAAaC,QAAQV,GACvD,GAAIO,EACF,OAAON,EAAqBM,GAGhC,GAAyB,qBAAdI,UAA2B,CACpC,GAAIA,UAAUC,WAAaD,UAAUC,UAAU,GAC7C,OAAOX,EAAqBU,UAAUC,UAAU,IAGlD,GAAID,UAAUE,SACZ,OAAOZ,EAAqBU,UAAUE,UAExC,GAAIF,UAAUG,aACZ,OAAOb,EAAqBU,UAAUG,cAI1C,OAAOxB,s9CC/CT,IAAMyB,EAAYC,IAAOC,IAAVC,KAITC,EAAYH,IAAOC,IAAVG,KAOTC,EAAaL,IAAOC,IAAVK,KAIVC,cACJ,SAAAA,EAAYC,GAAO,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAL,IACjBE,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAH,GAAAQ,KAAAH,KAAMJ,KAEDQ,MAAQ,GAEbP,EAAKQ,mBAAqBR,EAAKQ,mBAAmBC,KAAxBR,OAAAS,EAAA,EAAAT,CAAAD,IALTA,mFASjBjB,OAAO4B,iBAAiB,eAAgBR,KAAKK,mEAI7CzB,OAAO6B,oBAAoB,eAAgBT,KAAKK,+DAG/BK,GACCV,KAAKJ,MAAfe,MAGEC,KAAK,SAAAC,GAAC,OAAIA,EAAEC,OAASD,EAAEC,MAAMC,OAAS,MAC9CL,EAAEM,iBACFN,EAAEO,YAAc,yCAKlB,OACEC,EAAAC,EAAAC,cAACjC,EAAD,KACE+B,EAAAC,EAAAC,cAAC7B,EAAD,KACE2B,EAAAC,EAAAC,cAACC,EAAA,EAAD,OAEFH,EAAAC,EAAAC,cAAC3B,EAAD,KACEyB,EAAAC,EAAAC,cAACE,EAAA,EAAD,eAlCSC,aAiDJC,kBAAIC,EAAJD,CAAYE,YAJH,SAAAtB,GAAK,MAAK,CAChCO,MAAOgB,YAAcvB,KAGIsB,CAAyB/B,o5CC3DpD,IAAMiC,EAAYC,YAAU,SAAAC,GAA8B,IAA3BC,EAA2BD,EAA3BC,MAAOC,EAAoBF,EAApBE,OAC9BC,EAAc,EADoCH,EAAZI,MAE5C,OACEC,EAAAhB,EAAAC,cAAA,QACEW,MAAOK,KAAKC,IAAI,EAAGN,EAAQE,GAC3BD,OAAQI,KAAKC,IAAI,EAAGL,EAASC,GAC7BK,EAAGL,EAAc,EACjBM,EAAGN,EAAc,EACjBO,KAAK,wBACLC,OAAO,sBACPR,YAAaA,MASnB,SAASS,EAAaC,EAAKC,EAAOC,GAChC,SAAAC,OAAAhD,OAAAiD,EAAA,EAAAjD,CACK6C,EAAIK,MAAM,EAAGJ,IADlB9C,OAAAiD,EAAA,EAAAjD,CAEMmD,MAAMC,QAAQL,GAAQA,EAAO,CAACA,IAFpC/C,OAAAiD,EAAA,EAAAjD,CAGK6C,EAAIK,MAAMJ,EAAQ,KAGzB,IAAMO,EAAM,SAAAC,GAAC,OAAIhB,KAAKiB,MAAMD,IAEtBE,EAAelE,IAAOC,IAAVC,KAOZiE,EAAQnE,IAAOC,IAAVG,KAMLgE,EAAUpE,IAAOC,IAAVK,KAOPP,EAAYC,IAAOC,IAAVoE,KAQTC,EAAiBtE,IAAOC,IAAVsE,KAKdC,EAAUxE,IAAOyE,IAAVC,KASPC,EAAc3E,IAAO4E,KAAVC,KAMXC,EAAqB9E,IAAO4E,KAAVG,KAOlBC,cACJ,SAAAA,EAAYxE,GAAO,IAAAC,EAAA,OAAAC,OAAAuE,EAAA,EAAAvE,CAAAE,KAAAoE,IACjBvE,EAAAC,OAAAwE,EAAA,EAAAxE,CAAAE,KAAAF,OAAAyE,EAAA,EAAAzE,CAAAsE,GAAAjE,KAAAH,KAAMJ,KAEDQ,MAAQ,CACX8B,MAAO,IACPsC,YAAa,EACbC,aAAc,GAGhB5E,EAAK6E,cAAgB7E,EAAK6E,cAAcpE,KAAnBR,OAAA6E,EAAA,EAAA7E,CAAAD,IACrBA,EAAK+E,gBAAkB/E,EAAK+E,gBAAgBtE,KAArBR,OAAA6E,EAAA,EAAA7E,CAAAD,IACvBA,EAAKgF,cAAgBhF,EAAKgF,cAAcvE,KAAnBR,OAAA6E,EAAA,EAAA7E,CAAAD,IACrBA,EAAKiF,cAAgBjF,EAAKiF,cAAcxE,KAAnBR,OAAA6E,EAAA,EAAA7E,CAAAD,IAZJA,6EAeLkF,EAASC,GAAY,IAAAC,EAI7BjF,KAAKJ,MAFPsF,EAF+BD,EAE/BC,cAF+BC,EAAAF,EAG/BG,aAAgBC,EAHeF,EAGfE,KAAMvE,EAHSqE,EAGTrE,MAElBwE,EAAMxE,EAAMkE,EAAWO,YAE7BL,EACEG,EACA3C,EAAa5B,EAAOkE,EAAWO,WAAnBzF,OAAA0F,EAAA,EAAA1F,CAAA,GACPwF,EACAP,2CAKKU,EAAOT,GAAY,IAAAU,EAI3B1F,KAAKJ,MAFPsF,EAF6BQ,EAE7BR,cAF6BS,EAAAD,EAG7BN,aAGFF,EAN+BS,EAGbN,KAGE3C,EANWiD,EAGP7E,MAGgBkE,EAAWO,WAAY,8CAG1B,IAAvBjD,EAAuBsD,EAAvBtD,EAAGC,EAAoBqD,EAApBrD,EAAGR,EAAiB6D,EAAjB7D,MAAOC,EAAU4D,EAAV5D,OAAU6D,EACC7F,KAAKI,MAAnCoE,EAD6BqB,EAC7BrB,YAAaC,EADgBoB,EAChBpB,aACrB,MAAO,CACLnC,EAAGa,EAAIf,KAAK0D,IAAItB,EAAczC,EAAOK,KAAKC,IAAI,EAAGC,KACjDC,EAAGY,EAAIf,KAAK0D,IAAIrB,EAAezC,EAAQI,KAAKC,IAAI,EAAGE,iDAIO,IAAAwD,EAAAC,EAA5CC,aAAmBC,EAAyBH,EAA5BzD,EAAe6D,EAAaJ,EAAhBxD,EAAgB6D,EACtBpG,KAAKI,MAAnCoE,EADoD4B,EACpD5B,YAAaC,EADuC2B,EACvC3B,aACrB,MAAO,CACLnC,EAAGa,EAAIf,KAAK0D,IAAItB,EAAapC,KAAKC,IAAI,EAAG6D,KACzC3D,EAAGY,EAAIf,KAAK0D,IAAIrB,EAAcrC,KAAKC,IAAI,EAAG8D,uCAIrC,IAAAE,EAAArG,KACDsG,EAAc,SAAAC,GAAK,OACvBF,EAAKG,SAAS,SAAApG,GAAK,MAAK,CACtB8B,MAAOE,KAAKC,IA/HF,IA+HiBD,KAAK0D,IA9HtB,EA8HqC1F,EAAM8B,MAAQqE,QAH1DE,EAKsDzG,KAAKI,MAA1D8B,EALDuE,EAKCvE,MAAOsC,EALRiC,EAKQjC,YAAaC,EALrBgC,EAKqBhC,aAAciC,EALnCD,EAKmCC,OAAQC,EAL3CF,EAK2CE,OAElD,IAAK3G,KAAKJ,MAAMwF,aACd,OACEjD,EAAAhB,EAAAC,cAACkC,EAAD,KACEnB,EAAAhB,EAAAC,cAACwF,EAAA,EAAD,CAAkBC,GAAG,sBAVpB,IAAAC,EAkBH9G,KAAKJ,MAlBFmH,EAAAD,EAgBL1B,aAAgBtE,EAhBXiG,EAgBWjG,MAAakG,EAhBxBD,EAgBkB1B,KAA2B4B,EAhB7CF,EAgBkCG,UACvChC,EAjBK4B,EAiBL5B,cAGF,IAAK+B,EACH,OACE9E,EAAAhB,EAAAC,cAACkC,EAAD,KACEnB,EAAAhB,EAAAC,cAACwF,EAAA,EAAD,CACEC,GAAG,0BACHM,OAAQ,CAAEH,eAMlB,IAAMI,EAAStG,EAAMuG,IAAI,SAAC/B,EAAK1C,GAAU,IAC/Bb,EAAwBuD,EAAxBvD,MAAOC,EAAiBsD,EAAjBtD,OAAQM,EAASgD,EAAThD,EAAGC,EAAM+C,EAAN/C,EAC1B,OACEJ,EAAAhB,EAAAC,cAACQ,EAAD,CAEE0F,IAAK1E,EACL8B,cAAe2B,EAAK3B,cACpBE,gBAAiByB,EAAKzB,gBACtB5C,OAAQA,EACRuF,4BAA6B,EAC7BC,SAAUnB,EAAKxB,cACf4C,SAAUpB,EAAKvB,cACf4C,QAASC,OAAO/E,GAChB2C,WAAY3C,EACZb,MAAOA,EACPO,EAAGA,EACHC,EAAGA,MAKT,OACEJ,EAAAhB,EAAAC,cAACmC,EAAD,KACEpB,EAAAhB,EAAAC,cAACoC,EAAD,KACErB,EAAAhB,EAAAC,cAAA,UAAQwG,KAAK,SAASC,QAAS,kBAAMvB,EAAY,EAAIlE,KAAK0F,KAAK,MAA/D,KAGA3F,EAAAhB,EAAAC,cAAA,UAAQwG,KAAK,SAASC,QAAS,kBAAMvB,EAAYlE,KAAK0F,KAAK,MAA3D,MAIF3F,EAAAhB,EAAAC,cAACjC,EAAD,CACE4I,YAAa,SAAAtC,GACXuC,qBAAqB3B,EAAK4B,gBADN,IAEZC,EAAqBzC,EAArByC,QAASC,EAAY1C,EAAZ0C,QAFGC,EAGE/B,EAAKgC,UAAUC,wBAA7BC,EAHYH,EAGZG,IAAKC,EAHOJ,EAGPI,KACbnC,EAAK4B,eAAiBQ,sBAAsB,WAC1CpC,EAAKG,SAAS,CAAEE,OAAQwB,EAAUM,EAAM7B,OAAQwB,EAAUI,QAI9DpG,EAAAhB,EAAAC,cAACsC,EAAD,CAAgBgF,MAAO,CAAE3G,MAAOyC,EAActC,IAC5CC,EAAAhB,EAAAC,cAACuH,EAAA,EAAD,CACEzG,MAAOA,EACPsC,YAAaA,EACbC,aAAcA,EACdiE,MAAO,CAAEE,QAAS,UAElBzG,EAAAhB,EAAAC,cAACuH,EAAA,EAAD,CACEE,IAAK5B,EACL6B,OAAQ,SAAAC,GAAqC,IAAlCC,EAAkCD,EAAlCC,aAAcC,EAAoBF,EAApBE,cACvB5C,EAAKG,SAAS,CACZhC,YAAawE,EACbvE,aAAcwE,EACd/G,MAlNC,IAkNqBE,KAAKC,IAAI2G,EAAcC,QAKnD9G,EAAAhB,EAAAC,cAACuH,EAAA,EAAD,CACEjE,cAAe1E,KAAK0E,cACpBE,gBAAiB5E,KAAK4E,gBACtBsE,qBAAsBtH,EACtBuH,WAAY,SAAAC,GAA6B,IAA1B9G,EAA0B8G,EAA1B9G,EAAGC,EAAuB6G,EAAvB7G,EAAGR,EAAoBqH,EAApBrH,MAAOC,EAAaoH,EAAbpH,OAC1BkD,EAAc8B,EAAD,GAAAlE,OAAAhD,OAAAiD,EAAA,EAAAjD,CAAegB,GAAf,CAAsB,CAAEwB,IAAGC,IAAGR,QAAOC,gBAGrDoF,GAGHjF,EAAAhB,EAAAC,cAACwC,EAAD,CACEyF,IAAK,SAAAC,GACHjD,EAAKgC,UAAYiB,IAGnBnH,EAAAhB,EAAAC,cAAC8C,EAAD,CAAoBqF,GAAI7C,EAAQ8C,GAAI,EAAGC,GAAI/C,EAAQgD,GAAI,MACvDvH,EAAAhB,EAAAC,cAAC2C,EAAD,CAAawF,GAAI7C,EAAQ8C,GAAI,EAAGC,GAAI/C,EAAQgD,GAAI,MAChDvH,EAAAhB,EAAAC,cAAC8C,EAAD,CAAoBqF,GAAI,EAAGC,GAAI7C,EAAQ8C,GAAI,IAAOC,GAAI/C,IACtDxE,EAAAhB,EAAAC,cAAC2C,EAAD,CAAawF,GAAI,EAAGC,GAAI7C,EAAQ8C,GAAI,IAAOC,GAAI/C,eAtKxCpF,aAsLrB6C,EAAOuF,aAAe,CACpBvE,aAAc,MAGhB,IAIMwE,EAAqB,CACzB1E,cAAe2E,KAGFnI,gBARS,SAAAtB,GAAK,MAAK,CAChCgF,aAAc0E,YAAqB1J,KASnCwJ,EAFalI,CAGb0C,mrCC9RF,IAAMb,EAAQnE,IAAOC,IAAVC,KAOLyK,EAAS3K,IAAOC,IAAVG,KAMNL,EAAYC,IAAOC,IAAVK,KAQTsK,EAAO5K,IAAO6K,GAAVxG,KAMJyG,EAAW9K,IAAO+K,GAAVxG,KAMRyG,EAAahL,IAAOiL,OAAVvG,KAOVwG,EAAelL,IAAOiL,OAAVpG,KA0BZsG,cACJ,SAAAA,EAAY3K,GAAO,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAuK,IACjB1K,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAyK,GAAApK,KAAAH,KAAMJ,KAED4K,WAAa3K,EAAK2K,WAAWlK,KAAhBR,OAAAS,EAAA,EAAAT,CAAAD,IAHDA,mFAOjBjB,OAAO4B,iBAAiB,UAAWR,KAAKwK,2DAIxC5L,OAAO6B,oBAAoB,UAAWT,KAAKwK,+CAGlC/E,GAAO,IAAAY,EAAArG,KAGhB,IAAIyF,EAAMgF,iBAAV,CAIA,IAAIC,GAAU,EAERC,EAAU,WAAW,IAAVvH,EAAUwH,UAAA7J,OAAA,QAAA8J,IAAAD,UAAA,GAAAA,UAAA,GAAN,EAAME,EACuBzE,EAAKzG,MAA7Ce,EADiBmK,EACjBnK,MAAOoK,EADUD,EACVC,iBAAkBC,EADRF,EACQE,WAC3BC,EAAetK,EAAM0G,IAAI,SAAAxG,GAAC,OAAIA,EAAEwE,OAChC6F,EAAgBD,EAAaE,QAAQJ,GAEvCK,EAAuBH,EAAa,IAAM,KAC1CC,GAAiB,IACnBE,EACEH,GACGA,EAAalK,OAASmK,EAAgB9H,GAAK6H,EAAalK,SAI/DiK,EAAWI,IAGb,OAAQ3F,EAAM6B,KACZ,IAAK,IACL,IAAK,aACL,IAAK,YACHqD,EAAQ,GACR,MACF,IAAK,IACL,IAAK,YACL,IAAK,UACHA,GAAS,GACT,MACF,QACED,GAAU,EAGVA,GACFjF,EAAMzE,mDAID,IAAAqK,EAAArL,KAAAiF,EAQHjF,KAAKJ,MANPe,EAFKsE,EAELtE,MACA2K,EAHKrG,EAGLqG,SACAC,EAJKtG,EAILsG,eACAP,EALK/F,EAKL+F,WACAD,EANK9F,EAML8F,iBACAS,EAPKvG,EAOLuG,iBAGF,OACEtK,EAAAC,EAAAC,cAACmC,EAAD,KACErC,EAAAC,EAAAC,cAAC2I,EAAD,cAEE7I,EAAAC,EAAAC,cAAA,WACAF,EAAAC,EAAAC,cAAA,SACEwG,KAAK,OACL6D,UAAQ,EACRC,OAAO,UACPrC,IAAK,SAAAC,GACH+B,EAAKM,UAAYrC,GAEnB9B,SAAU,SAAA/B,IACHA,EAAMmG,OAAOjL,OAAS8E,EAAMmG,OAAOjL,MAAMI,OAAS,GAIvDuK,EAAS7F,EAAMmG,OAAOjL,UAG1BO,EAAAC,EAAAC,cAAA,WACAF,EAAAC,EAAAC,cAAA,UACEwG,KAAK,SACLiE,SAAUlL,EAAMI,OAAS,EACzB8G,QAAS,YAjHC,SAAAlH,GACpBmL,IAAUC,OACR,IAAIC,KACF,CACEC,KAAKC,UACHvL,EACGwL,OAAO,SAAAtL,GAAC,OAAKA,EAAEuL,SACf/E,IAAI,SAAAvF,GAAA,MAAsB,CACzBkF,SADGlF,EAAGuD,KAENvE,MAFGgB,EAAShB,WAMpB,CAAE8G,KAAM,mCAEV,cAmGUyE,CAAc1L,KAJlB,UASAO,EAAAC,EAAAC,cAAA,UACEwG,KAAK,SACLiE,SAAUlL,EAAMI,OAAS,EACzB8G,QAAS,WAGLjJ,OAAO0N,QACL,qDAGFf,IACAF,EAAKM,UAAUY,MAAQ,MAX7B,cAkBFrL,EAAAC,EAAAC,cAACjC,EAAD,KACE+B,EAAAC,EAAAC,cAAC4I,EAAD,KACGrJ,EAAM0G,IAAI,SAAAzB,GAA6B,IAA1BP,EAA0BO,EAA1BP,KAAMvE,EAAoB8E,EAApB9E,MAAOsL,EAAaxG,EAAbwG,OACrBI,EAAa,cASjB,OARIJ,EACFI,EAAa,OACJnH,IAAS0F,EAClByB,EAAa,YACJ1L,EAAMC,OAAS,IACxByL,EAAa,cAIbtL,EAAAC,EAAAC,cAAC8I,EAAD,CAAU5C,IAAKjC,EAAMqD,MAAO,CAAE8D,eAC5BtL,EAAAC,EAAAC,cAACgJ,EAAD,CACExC,KAAK,SACLc,MAAO,CACL+D,eAAgBL,EAAS,oBAAiBvB,GAE5ChD,QAAS,kBAAMmD,EAAW3F,KAEzBA,GAEHnE,EAAAC,EAAAC,cAACkJ,EAAD,CACE1C,KAAK,SACLC,QAAS,kBAAM2D,EAAiBnG,KAFlC,qBA7IM9D,aA0KxBgJ,EAAUZ,aAAe,CACvBoB,iBAAkB,MAGpB,IAKMnB,EAAqB,CACzB0B,SAAUzB,IACV0B,eAAgB1B,IAChBmB,WAAYnB,IACZ2B,iBAAkB3B,KAGLnI,gBAZS,SAAAtB,GAAK,MAAK,CAChCO,MAAOgB,YAAcvB,GACrB2K,iBAAkB2B,YAAyBtM,KAY3CwJ,EAFalI,CAGb6I,mFCpQIoC,EAAgB,CACpBpO,OAAQ,KACRqO,KAAM,CACJC,SAAU,IAEZC,GAAI,CACF/B,iBAAkB,OA6CPgC,gCAAgB,CAC7BxO,OAVF,WAAsD,IAAtC6B,EAAsCwK,UAAA7J,OAAA,QAAA8J,IAAAD,UAAA,GAAAA,UAAA,GAA9B+B,EAAcpO,OAAQyO,EAAQpC,UAAA7J,OAAA,EAAA6J,UAAA,QAAAC,EACpD,OAAQmC,EAAOpF,MACb,KAAKiC,IACH,OAAOmD,EAAOC,QAAQC,KACxB,QACE,OAAO9M,IAMXwM,KA3CF,WAAkD,IAApCxM,EAAoCwK,UAAA7J,OAAA,QAAA8J,IAAAD,UAAA,GAAAA,UAAA,GAA5B+B,EAAcC,KAAMI,EAAQpC,UAAA7J,OAAA,EAAA6J,UAAA,QAAAC,EAChD,OAAQmC,EAAOpF,MACb,KAAKiC,IACH,OAAO/J,OAAAqN,EAAA,EAAArN,CAAA,GACFM,EADL,CAEEyM,SAAUG,EAAOC,UAErB,QACE,OAAO7M,IAoCX0M,GAhCF,WAA8C,IAAlC1M,EAAkCwK,UAAA7J,OAAA,QAAA8J,IAAAD,UAAA,GAAAA,UAAA,GAA1B+B,EAAcG,GAAIE,EAAQpC,UAAA7J,OAAA,EAAA6J,UAAA,QAAAC,EAC5C,OAAQmC,EAAOpF,MACb,KAAKiC,IACH,OAAO/J,OAAAqN,EAAA,EAAArN,CAAA,GACFM,EADL,CAEE2K,iBAAkBiC,EAAOC,UAE7B,KAAKpD,IACH,OAAO/J,OAAAqN,EAAA,EAAArN,CAAA,GACFM,EADL,CAEE2K,kBACG3K,EAAM2K,kBAAoBjL,OAAOsN,KAAKJ,EAAOC,SAASlM,OAAS,EAC5DiM,EAAOC,QAAQnN,OAAOsN,KAAKJ,EAAOC,SAAS,IAAI5H,KAC/CjF,EAAM2K,mBAEhB,QACE,OAAO3K,MCpCE5C,EAAA,WAAS6P,GACtB,IAAMC,EAAa,CAACC,KAEpB,OAAOC,sBACLC,EACAJ,EACAK,8BAAoBC,kBAAeC,WAAf,EAAmBN,qlECErCO,UAAgBC,eAChBT,EAAe,CACnB9O,OAAQZ,cACRiP,KAAM,CAAEC,SAAUiB,eAClBhB,GAAI,CAAE/B,iBAAkBjL,OAAOsN,KAAKS,GAAe,KAE/CE,EAAYC,YAAeX,GAEjCY,YAAa,GAAAnL,OAAAhD,OAAAoO,EAAA,EAAApO,CAAK/B,KAAL+B,OAAAoO,EAAA,EAAApO,CAAY7B,OAEzB,IAAMkQ,EAAwBzM,YAAQ,SAAAI,GAAA,IAAGvD,EAAHuD,EAAGvD,OAAH,MAAiB,CACrDA,SACAd,SAAUA,IAASc,KAFSmD,CAG1B0M,KAGFC,IAASC,OACPC,EAAApN,EAAAC,cAACoN,EAAA,EAAD,CAAUC,MAAOV,GACfQ,EAAApN,EAAAC,cAAC+M,EAAD,CAAuBO,cAAehR,KACpC6Q,EAAApN,EAAAC,cAACuN,EAAA,EAAD,QAGJtR,EAAOuR,SAASC,eAAe,uVCjCtBC,EAAgB,gBACvBC,EAAc,SAAAlC,GAGlB,OAFAmC,YAAanC,GAEN,CACLjF,KAAMkH,EACN7B,QAASJ,IAKAvB,EAAW,SAAA2D,GAAQ,OAAI,SAACC,EAAUC,GAAa,IAClDtC,EAAasC,IAAWvC,KAAxBC,SACFuC,EAAkBnM,MAAMoM,KAAKJ,GAAUK,OAC3C,SAACC,EAAKC,GASJ,OARKD,EAAIC,EAAKnK,OAAUkK,EAAIC,EAAKnK,MAAM6B,YACrCqI,EAAIC,EAAKnK,MAATvF,OAAA2P,EAAA,EAAA3P,CAAA,CACEuF,KAAMmK,EAAKnK,KACXvE,MAAO,IACHyO,EAAIC,EAAKnK,OAAS,GAHxB,CAIE6B,UAAWwI,IAAIC,gBAAgBH,MAG5BD,GAVazP,OAAA2P,EAAA,EAAA3P,CAAA,GAYjB+M,IAGPqC,EAASH,EAAYK,MAGVQ,EAAc,cACd5E,EAAa,SAAAhE,GAAQ,MAAK,CACrCY,KAAMgI,EACN3C,QAASjG,IAGE9B,EAAgB,SAAC8B,EAAUlG,GAAX,OAAqB,SAACoO,EAAUC,GAAa,IAChEtC,EAAasC,IAAWvC,KAAxBC,SAERqC,EACEH,EAAYjP,OAAA2P,EAAA,EAAA3P,CAAA,GACP+M,EADM/M,OAAA+P,EAAA,EAAA/P,CAAA,GAERkH,EAFQlH,OAAA2P,EAAA,EAAA3P,CAAA,GAGJ+M,EAAS7F,GAHL,CAIPlG,gBAMK0K,EAAmB,SAAAxE,GAAQ,OAAI,SAACkI,EAAUC,GAAa,IAC1DtC,EAAasC,IAAWvC,KAAxBC,SAERqC,EACEH,EAAYjP,OAAA2P,EAAA,EAAA3P,CAAA,GACP+M,EADM/M,OAAA+P,EAAA,EAAA/P,CAAA,GAERkH,EAFQlH,OAAA2P,EAAA,EAAA3P,CAAA,GAGJ+M,EAAS7F,GAHL,CAIPoF,QAASS,EAAS7F,GAAUoF,eAMvBb,EAAiB,kBAAMwD,EAAY,KAEnCe,EAAkB,iHCrE/BxS,EAAAC,EAAAC,EAAA,sBAAAkP,IAAApP,EAAAC,EAAAC,EAAA,sBAAAmE,IAAArE,EAAAC,EAAAC,EAAA,sBAAAsM,IAAA,IAAAiG,EAAAzS,EAAA,KAEM0S,EAAmB,SAAA5P,GAAK,OAAIA,EAAMwM,KAAKC,UAChCH,EAA2B,SAAAtM,GAAK,OAAIA,EAAM0M,GAAG/B,kBAE7CpJ,EAAgBsO,YAC3BD,EACA,SAAAnD,GAAQ,OAAI/M,OAAOsN,KAAKP,GAAUxF,IAAI,SAAAL,GAAQ,OAAI6F,EAAS7F,OAGhD8C,EAAuBmG,YAClCD,EACAtD,EACA,SAACG,EAAU9B,GAAX,OAAgC8B,EAAS9B,uCCb3C,SAAA1N,GAAO,SAASqB,IACd,GAA6B,qBAAlBrB,EAAOuB,OAAwB,OAAO,EAEjD,IAAMsR,EAAO,mBACb,IAGE,OAFA7S,EAAOuB,OAAOC,aAAasR,QAAQD,EAAMA,GACzC7S,EAAOuB,OAAOC,aAAauR,WAAWF,IAC/B,EACP,MAAOxP,GACP,OAAO,GATXpD,EAAAC,EAAAC,EAAA,sBAAAkB,6ICEM2R,EAAwB,wBACxBC,EAA0B,EACzB,SAASxC,IACd,GAAIpP,cAA2B,CAC7B,IAAM6R,EAAsB3R,OAAOC,aAAaC,QAC9CuR,GAEF,GAAIE,EACF,IACE,IAAMC,EAAgBvE,KAAKwE,MAAMF,GACjC,GAAIC,EAAcE,UAAYJ,EAC5B,OAAOE,EAAcG,SAEvB,MAAOC,KAMb,MAAO,GAGF,SAAS5B,EAAanC,GACvBnO,eACFE,OAAOC,aAAasR,QAClBE,EACApE,KAAKC,UAAU,CACbwE,QAASJ,EACTK,SAAU7Q,OAAOsN,KAAKP,GAAUyC,OAAO,SAACC,EAAKvI,GAAa,IAAA6J,EACThE,EAAS7F,GAAlC8J,GADkCD,EAChD3J,UADgDpH,OAAAiR,EAAA,EAAAjR,CAAA+Q,EAAA,gBAIxD,OAFAtB,EAAIvI,GAAY8J,EAETvB,GACN","file":"static/js/main.5c6f9ba2.chunk.js","sourcesContent":["import enMessages from './en.json';\nimport jaMessages from './ja.json';\nimport { isLocalStorageAvailable } from '../generic';\n\nexport const getPhrases = lang => {\n  if (lang === 'en') {\n    return enMessages;\n  }\n  if (lang === 'ja') {\n    return jaMessages;\n  }\n  return null;\n};\n\nexport const messages = {\n  en: enMessages,\n  ja: jaMessages,\n};\n\nexport const languagesList = {\n  ja: '日本語',\n  en: 'English',\n};\n\nexport const DEFAULT_LOCALE = 'en';\nconst LOCALE_STORAGE_KEY = 'REMEMBER_LOCALE';\n\nexport function getBrowserLocale() {\n  const normalizeWithDefault = str => {\n    const locale = str.toLowerCase().split(/[_-]+/)[0];\n    if (locale in languagesList) {\n      return locale;\n    }\n\n    return DEFAULT_LOCALE;\n  };\n\n  if (isLocalStorageAvailable()) {\n    const savedLocale = global.window.localStorage.getItem(LOCALE_STORAGE_KEY);\n    if (savedLocale) {\n      return normalizeWithDefault(savedLocale);\n    }\n  }\n  if (typeof navigator !== 'undefined') {\n    if (navigator.languages && navigator.languages[0]) {\n      return normalizeWithDefault(navigator.languages[0]);\n    }\n\n    if (navigator.language) {\n      return normalizeWithDefault(navigator.language);\n    }\n    if (navigator.userLanguage) {\n      return normalizeWithDefault(navigator.userLanguage);\n    }\n  }\n\n  return DEFAULT_LOCALE;\n}\n\nexport function saveBrowserLocale(locale) {\n  if (isLocalStorageAvailable()) {\n    global.window.localStorage.setItem(LOCALE_STORAGE_KEY, locale);\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport { connect } from 'react-redux';\nimport { hot } from 'react-hot-loader';\nimport { filesSelector } from '../selectors';\nimport Editor from './Editor';\nimport ImageList from './ImageList';\n\nconst Container = styled.div`\n  display: relative;\n  min-height: 100vh;\n`;\nconst LeftChild = styled.div`\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 200px;\n  height: 100%;\n`;\nconst RightChild = styled.div`\n  padding-left: 200px;\n`;\n\nclass View extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {};\n\n    this.warnBeforeNavigate = this.warnBeforeNavigate.bind(this);\n  }\n\n  componentDidMount() {\n    window.addEventListener('beforeunload', this.warnBeforeNavigate);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('beforeunload', this.warnBeforeNavigate);\n  }\n\n  warnBeforeNavigate(e) {\n    const { files } = this.props;\n\n    // Warn before navigation if any boxes have been set\n    if (files.some(f => f.boxes && f.boxes.length > 0)) {\n      e.preventDefault();\n      e.returnValue = 'stop';\n    }\n  }\n\n  render() {\n    return (\n      <Container>\n        <LeftChild>\n          <ImageList />\n        </LeftChild>\n        <RightChild>\n          <Editor />\n        </RightChild>\n      </Container>\n    );\n  }\n}\n\nView.propTypes = {\n  files: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n};\n\nconst mapStateToProps = state => ({\n  files: filesSelector(state),\n});\n\nexport default hot(module)(connect(mapStateToProps)(View));\n","import React, { Component } from 'react';\nimport styled from 'styled-components';\nimport { FormattedMessage } from 'react-intl';\nimport PropTypes from 'prop-types';\nimport {\n  ShapeEditor,\n  ImageLayer,\n  DrawLayer,\n  wrapShape,\n} from 'react-shape-editor';\nimport { connect } from 'react-redux';\nimport { selectedFileSelector } from '../selectors';\nimport * as actions from '../actions';\n\nconst RectShape = wrapShape(({ width, height, scale }) => {\n  const strokeWidth = 2 / scale;\n  return (\n    <rect\n      width={Math.max(0, width - strokeWidth)}\n      height={Math.max(0, height - strokeWidth)}\n      x={strokeWidth / 2}\n      y={strokeWidth / 2}\n      fill=\"rgba(100,100,255,0.3)\"\n      stroke=\"rgba(100,100,255,1)\"\n      strokeWidth={strokeWidth}\n    />\n  );\n});\n\nconst MAX_FIT_SIZE = 500;\nconst MIN_SCALE = 0.05;\nconst MAX_SCALE = 4;\n\nfunction arrayReplace(arr, index, item) {\n  return [\n    ...arr.slice(0, index),\n    ...(Array.isArray(item) ? item : [item]),\n    ...arr.slice(index + 1),\n  ];\n}\nconst to5 = n => Math.round(n);\n\nconst IssueWrapper = styled.div`\n  padding: 3rem;\n  max-width: 600px;\n  margin: auto;\n  white-space: pre-wrap;\n`;\n\nconst Outer = styled.div`\n  display: flex;\n  height: 100vh;\n  flex-direction: column;\n`;\n\nconst Toolbar = styled.div`\n  flex: 0 1 auto;\n  border-bottom: solid gray 2px;\n  padding: 5px 10px;\n  background: #eaeaea;\n`;\n\nconst Container = styled.div`\n  text-align: center;\n  flex: 1 1 auto;\n  width: 100%;\n  overflow: auto;\n  background: #ffeaff;\n`;\n\nconst InnerContainer = styled.div`\n  position: relative;\n  margin: auto;\n`;\n\nconst Overlay = styled.svg`\n  width: 100%;\n  position: absolute;\n  pointer-events: none;\n  left: 0;\n  top: 0;\n  height: 100%;\n`;\n\nconst OverlayLine = styled.line`\n  stroke: #fff;\n  stroke-width: 0.8px;\n  stroke-dasharray: 5, 15;\n`;\n\nconst OverlayLineOutline = styled.line`\n  stroke: #6464ff;\n  stroke-width: 1.5px;\n  stroke-dashoffset: 0.5px;\n  stroke-dasharray: 6, 14;\n`;\n\nclass Editor extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      scale: 0.75,\n      vectorWidth: 0,\n      vectorHeight: 0,\n    };\n\n    this.constrainMove = this.constrainMove.bind(this);\n    this.constrainResize = this.constrainResize.bind(this);\n    this.onShapeChange = this.onShapeChange.bind(this);\n    this.onShapeDelete = this.onShapeDelete.bind(this);\n  }\n\n  onShapeChange(newRect, shapeProps) {\n    const {\n      setImageBoxes,\n      selectedFile: { name, boxes },\n    } = this.props;\n    const box = boxes[shapeProps.shapeIndex];\n\n    setImageBoxes(\n      name,\n      arrayReplace(boxes, shapeProps.shapeIndex, {\n        ...box,\n        ...newRect,\n      })\n    );\n  }\n\n  onShapeDelete(event, shapeProps) {\n    const {\n      setImageBoxes,\n      selectedFile: { name, boxes },\n    } = this.props;\n\n    setImageBoxes(name, arrayReplace(boxes, shapeProps.shapeIndex, []));\n  }\n\n  constrainMove({ x, y, width, height }) {\n    const { vectorWidth, vectorHeight } = this.state;\n    return {\n      x: to5(Math.min(vectorWidth - width, Math.max(0, x))),\n      y: to5(Math.min(vectorHeight - height, Math.max(0, y))),\n    };\n  }\n\n  constrainResize({ movingCorner: { x: movingX, y: movingY } }) {\n    const { vectorWidth, vectorHeight } = this.state;\n    return {\n      x: to5(Math.min(vectorWidth, Math.max(0, movingX))),\n      y: to5(Math.min(vectorHeight, Math.max(0, movingY))),\n    };\n  }\n\n  render() {\n    const changeScale = ratio =>\n      this.setState(state => ({\n        scale: Math.max(MIN_SCALE, Math.min(MAX_SCALE, state.scale * ratio)),\n      }));\n    const { scale, vectorWidth, vectorHeight, mouseX, mouseY } = this.state;\n\n    if (!this.props.selectedFile) {\n      return (\n        <IssueWrapper>\n          <FormattedMessage id=\"editor.needsFile\" />\n        </IssueWrapper>\n      );\n    }\n\n    const {\n      selectedFile: { boxes, name: filename, objectURL: imageSrc },\n      setImageBoxes,\n    } = this.props;\n\n    if (!imageSrc) {\n      return (\n        <IssueWrapper>\n          <FormattedMessage\n            id=\"editor.fileCacheMissing\"\n            values={{ filename }}\n          />\n        </IssueWrapper>\n      );\n    }\n\n    const shapes = boxes.map((box, index) => {\n      const { width, height, x, y } = box;\n      return (\n        <RectShape\n          // eslint-disable-next-line react/no-array-index-key\n          key={index}\n          constrainMove={this.constrainMove}\n          constrainResize={this.constrainResize}\n          height={height}\n          keyboardTransformMultiplier={5}\n          onChange={this.onShapeChange}\n          onDelete={this.onShapeDelete}\n          shapeId={String(index)}\n          shapeIndex={index}\n          width={width}\n          x={x}\n          y={y}\n        />\n      );\n    });\n\n    return (\n      <Outer>\n        <Toolbar>\n          <button type=\"button\" onClick={() => changeScale(1 / Math.sqrt(2))}>\n            -\n          </button>\n          <button type=\"button\" onClick={() => changeScale(Math.sqrt(2))}>\n            +\n          </button>\n        </Toolbar>\n        <Container\n          onMouseMove={event => {\n            cancelAnimationFrame(this.overlayRequest);\n            const { clientX, clientY } = event;\n            const { top, left } = this.overlayEl.getBoundingClientRect();\n            this.overlayRequest = requestAnimationFrame(() => {\n              this.setState({ mouseX: clientX - left, mouseY: clientY - top });\n            });\n          }}\n        >\n          <InnerContainer style={{ width: vectorWidth * scale }}>\n            <ShapeEditor\n              scale={scale}\n              vectorWidth={vectorWidth}\n              vectorHeight={vectorHeight}\n              style={{ display: 'block' }}\n            >\n              <ImageLayer\n                src={imageSrc}\n                onLoad={({ naturalWidth, naturalHeight }) => {\n                  this.setState({\n                    vectorWidth: naturalWidth,\n                    vectorHeight: naturalHeight,\n                    scale: MAX_FIT_SIZE / Math.max(naturalWidth, naturalHeight),\n                  });\n                }}\n              />\n\n              <DrawLayer\n                constrainMove={this.constrainMove}\n                constrainResize={this.constrainResize}\n                DrawPreviewComponent={RectShape}\n                onAddShape={({ x, y, width, height }) => {\n                  setImageBoxes(filename, [...boxes, { x, y, width, height }]);\n                }}\n              />\n              {shapes}\n            </ShapeEditor>\n\n            <Overlay\n              ref={el => {\n                this.overlayEl = el;\n              }}\n            >\n              <OverlayLineOutline x1={mouseX} y1={0} x2={mouseX} y2={10000} />\n              <OverlayLine x1={mouseX} y1={0} x2={mouseX} y2={10000} />\n              <OverlayLineOutline x1={0} y1={mouseY} x2={10000} y2={mouseY} />\n              <OverlayLine x1={0} y1={mouseY} x2={10000} y2={mouseY} />\n            </Overlay>\n          </InnerContainer>\n        </Container>\n      </Outer>\n    );\n  }\n}\n\nEditor.propTypes = {\n  selectedFile: PropTypes.shape({\n    boxes: PropTypes.arrayOf(PropTypes.shape({})),\n  }),\n  setImageBoxes: PropTypes.func.isRequired,\n};\n\nEditor.defaultProps = {\n  selectedFile: null,\n};\n\nconst mapStateToProps = state => ({\n  selectedFile: selectedFileSelector(state),\n});\n\nconst mapDispatchToProps = {\n  setImageBoxes: actions.setImageBoxes,\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Editor);\n","import React, { Component } from 'react';\nimport styled from 'styled-components';\nimport PropTypes from 'prop-types';\nimport FileSaver from 'file-saver';\nimport { connect } from 'react-redux';\nimport * as actions from '../actions';\nimport { filesSelector, selectedFilenameSelector } from '../selectors';\n\nconst Outer = styled.div`\n  display: flex;\n  height: 100vh;\n  flex-direction: column;\n  box-shadow: 1px 0 4px 0 #000;\n`;\n\nconst Header = styled.div`\n  flex: 0 1 auto;\n  border-bottom: solid gray 2px;\n  padding: 5px 10px;\n`;\n\nconst Container = styled.div`\n  text-align: center;\n  flex: 1 1 auto;\n  width: 100%;\n  overflow: auto;\n  background: #fff;\n`;\n\nconst List = styled.ul`\n  list-style: none;\n  margin: 0;\n  padding: 0;\n`;\n\nconst ListItem = styled.li`\n  text-align: center;\n  border-bottom: solid black 1px;\n  display: flex;\n`;\n\nconst ItemButton = styled.button`\n  background: none;\n  border: none;\n  height: 2rem;\n  flex: 1 1 auto;\n`;\n\nconst IgnoreButton = styled.button`\n  background: none;\n  border: none;\n  height: 2rem;\n  flex: 0 1 auto;\n`;\n\nconst exportResults = files => {\n  FileSaver.saveAs(\n    new Blob(\n      [\n        JSON.stringify(\n          files\n            .filter(f => !f.ignore)\n            .map(({ name, boxes }) => ({\n              filename: name,\n              boxes,\n            }))\n        ),\n      ],\n      { type: 'application/json;charset=utf-8' }\n    ),\n    'boxes.json'\n  );\n};\n\nclass ImageList extends Component {\n  constructor(props) {\n    super(props);\n\n    this.keyHandler = this.keyHandler.bind(this);\n  }\n\n  componentDidMount() {\n    window.addEventListener('keydown', this.keyHandler);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('keydown', this.keyHandler);\n  }\n\n  keyHandler(event) {\n    // If the keydown event has already been handled by some other custom\n    // handler, we abort here.\n    if (event.defaultPrevented) {\n      return;\n    }\n\n    let handled = true;\n\n    const advance = (n = 1) => {\n      const { files, selectedFilename, selectFile } = this.props;\n      const filenameList = files.map(f => f.name);\n      const selectedIndex = filenameList.indexOf(selectedFilename);\n\n      let nextSelectedFilename = filenameList[0] || null;\n      if (selectedIndex >= 0) {\n        nextSelectedFilename =\n          filenameList[\n            (filenameList.length + selectedIndex + n) % filenameList.length\n          ];\n      }\n\n      selectFile(nextSelectedFilename);\n    };\n\n    switch (event.key) {\n      case 'x':\n      case 'ArrowRight':\n      case 'ArrowDown':\n        advance(1);\n        break;\n      case 'z':\n      case 'ArrowLeft':\n      case 'ArrowUp':\n        advance(-1);\n        break;\n      default:\n        handled = false;\n    }\n\n    if (handled) {\n      event.preventDefault();\n    }\n  }\n\n  render() {\n    const {\n      files,\n      addFiles,\n      removeAllFiles,\n      selectFile,\n      selectedFilename,\n      toggleIgnoreFile,\n    } = this.props;\n\n    return (\n      <Outer>\n        <Header>\n          Images\n          <br />\n          <input\n            type=\"file\"\n            multiple\n            accept=\"image/*\"\n            ref={el => {\n              this.fileInput = el;\n            }}\n            onChange={event => {\n              if (!event.target.files || event.target.files.length < 1) {\n                return;\n              }\n\n              addFiles(event.target.files);\n            }}\n          />\n          <br />\n          <button\n            type=\"button\"\n            disabled={files.length < 1}\n            onClick={() => {\n              exportResults(files);\n            }}\n          >\n            Export\n          </button>\n          <button\n            type=\"button\"\n            disabled={files.length < 1}\n            onClick={() => {\n              if (\n                // eslint-disable-next-line no-alert\n                window.confirm(\n                  'Do you really want to delete all file metadata?'\n                )\n              ) {\n                removeAllFiles();\n                this.fileInput.value = '';\n              }\n            }}\n          >\n            Clear All\n          </button>\n        </Header>\n        <Container>\n          <List>\n            {files.map(({ name, boxes, ignore }) => {\n              let background = 'transparent';\n              if (ignore) {\n                background = 'gray';\n              } else if (name === selectedFilename) {\n                background = 'lightblue';\n              } else if (boxes.length > 0) {\n                background = 'lightgreen';\n              }\n\n              return (\n                <ListItem key={name} style={{ background }}>\n                  <ItemButton\n                    type=\"button\"\n                    style={{\n                      textDecoration: ignore ? 'line-through' : undefined,\n                    }}\n                    onClick={() => selectFile(name)}\n                  >\n                    {name}\n                  </ItemButton>\n                  <IgnoreButton\n                    type=\"button\"\n                    onClick={() => toggleIgnoreFile(name)}\n                  >\n                    ×\n                  </IgnoreButton>\n                </ListItem>\n              );\n            })}\n          </List>\n        </Container>\n      </Outer>\n    );\n  }\n}\n\nImageList.propTypes = {\n  addFiles: PropTypes.func.isRequired,\n  files: PropTypes.arrayOf(\n    PropTypes.shape({\n      name: PropTypes.string,\n      boxes: PropTypes.arrayOf(PropTypes.shape({})),\n    })\n  ).isRequired,\n  removeAllFiles: PropTypes.func.isRequired,\n  selectFile: PropTypes.func.isRequired,\n  selectedFilename: PropTypes.string,\n  toggleIgnoreFile: PropTypes.func.isRequired,\n};\nImageList.defaultProps = {\n  selectedFilename: null,\n};\n\nconst mapStateToProps = state => ({\n  files: filesSelector(state),\n  selectedFilename: selectedFilenameSelector(state),\n});\n\nconst mapDispatchToProps = {\n  addFiles: actions.addFiles,\n  removeAllFiles: actions.removeAllFiles,\n  selectFile: actions.selectFile,\n  toggleIgnoreFile: actions.toggleIgnoreFile,\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(ImageList);\n","import { combineReducers } from 'redux';\nimport * as actions from './actions';\n\nconst DEFAULT_STATE = {\n  locale: 'ja',\n  data: {\n    fileDict: {},\n  },\n  ui: {\n    selectedFilename: null,\n  },\n};\n\nfunction data(state = DEFAULT_STATE.data, action) {\n  switch (action.type) {\n    case actions.SET_FILE_DICT:\n      return {\n        ...state,\n        fileDict: action.payload,\n      };\n    default:\n      return state;\n  }\n}\n\nfunction ui(state = DEFAULT_STATE.ui, action) {\n  switch (action.type) {\n    case actions.SELECT_FILE:\n      return {\n        ...state,\n        selectedFilename: action.payload,\n      };\n    case actions.SET_FILE_DICT:\n      return {\n        ...state,\n        selectedFilename:\n          !state.selectedFilename && Object.keys(action.payload).length > 0\n            ? action.payload[Object.keys(action.payload)[0]].name\n            : state.selectedFilename,\n      };\n    default:\n      return state;\n  }\n}\n\nfunction locale(state = DEFAULT_STATE.locale, action) {\n  switch (action.type) {\n    case actions.SWITCH_LANGUAGE:\n      return action.payload.lang;\n    default:\n      return state;\n  }\n}\n\nexport default combineReducers({\n  locale,\n  data,\n  ui,\n});\n","import { createStore, applyMiddleware } from 'redux';\nimport thunk from 'redux-thunk';\nimport { composeWithDevTools } from 'redux-devtools-extension';\nimport rootReducer from './reducers';\n\nexport default function(initialState) {\n  const middleware = [thunk];\n\n  return createStore(\n    rootReducer,\n    initialState,\n    composeWithDevTools(applyMiddleware(...middleware))\n  );\n}\n","import 'core-js';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { connect, Provider } from 'react-redux';\nimport { addLocaleData, IntlProvider } from 'react-intl';\nimport en from 'react-intl/locale-data/en';\nimport ja from 'react-intl/locale-data/ja';\nimport configureStore from './configureStore';\nimport View from './containers/View';\nimport { DEFAULT_LOCALE, getBrowserLocale, messages } from './utils/I18N';\nimport { getSavedFileMeta } from './utils/localStore';\nimport './index.css';\n\nconst savedFileDict = getSavedFileMeta();\nconst initialState = {\n  locale: getBrowserLocale(),\n  data: { fileDict: getSavedFileMeta() },\n  ui: { selectedFilename: Object.keys(savedFileDict)[0] },\n};\nconst initStore = configureStore(initialState);\n\naddLocaleData([...en, ...ja]);\n\nconst ConnectedIntlProvider = connect(({ locale }) => ({\n  locale,\n  messages: messages[locale],\n}))(IntlProvider);\n\nfunction render() {\n  ReactDOM.render(\n    <Provider store={initStore}>\n      <ConnectedIntlProvider defaultLocale={DEFAULT_LOCALE}>\n        <View />\n      </ConnectedIntlProvider>\n    </Provider>,\n    global.document.getElementById('app')\n  );\n}\n\nrender();\n","import { saveFileMeta } from './utils/localStore';\n\nexport const SET_FILE_DICT = 'SET_FILE_DICT';\nconst setFileDict = fileDict => {\n  saveFileMeta(fileDict);\n\n  return {\n    type: SET_FILE_DICT,\n    payload: fileDict,\n  };\n};\n\nexport const ADD_FILES = 'ADD_FILES';\nexport const addFiles = fileList => (dispatch, getState) => {\n  const { fileDict } = getState().data;\n  const updatedFileDict = Array.from(fileList).reduce(\n    (acc, file) => {\n      if (!acc[file.name] || !acc[file.name].objectURL) {\n        acc[file.name] = {\n          name: file.name,\n          boxes: [],\n          ...(acc[file.name] || {}),\n          objectURL: URL.createObjectURL(file),\n        };\n      }\n      return acc;\n    },\n    { ...fileDict }\n  );\n\n  dispatch(setFileDict(updatedFileDict));\n};\n\nexport const SELECT_FILE = 'SELECT_FILE';\nexport const selectFile = filename => ({\n  type: SELECT_FILE,\n  payload: filename,\n});\n\nexport const setImageBoxes = (filename, boxes) => (dispatch, getState) => {\n  const { fileDict } = getState().data;\n\n  dispatch(\n    setFileDict({\n      ...fileDict,\n      [filename]: {\n        ...fileDict[filename],\n        boxes,\n      },\n    })\n  );\n};\n\nexport const toggleIgnoreFile = filename => (dispatch, getState) => {\n  const { fileDict } = getState().data;\n\n  dispatch(\n    setFileDict({\n      ...fileDict,\n      [filename]: {\n        ...fileDict[filename],\n        ignore: !fileDict[filename].ignore,\n      },\n    })\n  );\n};\n\nexport const removeAllFiles = () => setFileDict({});\n\nexport const SWITCH_LANGUAGE = 'SWITCH_LANGUAGE';\nexport const switchLanguage = lang => ({\n  type: SWITCH_LANGUAGE,\n  payload: { lang },\n});\n","import { createSelector } from 'reselect';\n\nconst fileDictSelector = state => state.data.fileDict;\nexport const selectedFilenameSelector = state => state.ui.selectedFilename;\n\nexport const filesSelector = createSelector(\n  fileDictSelector,\n  fileDict => Object.keys(fileDict).map(filename => fileDict[filename])\n);\n\nexport const selectedFileSelector = createSelector(\n  fileDictSelector,\n  selectedFilenameSelector,\n  (fileDict, selectedFilename) => fileDict[selectedFilename]\n);\n","export function isLocalStorageAvailable() {\n  if (typeof global.window === 'undefined') return false;\n\n  const test = '__storage_test__';\n  try {\n    global.window.localStorage.setItem(test, test);\n    global.window.localStorage.removeItem(test);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n","import { isLocalStorageAvailable } from './generic';\n\nconst FILE_META_STORAGE_KEY = 'FILE_META_STORAGE_KEY';\nconst CURRENT_STORAGE_VERSION = 1;\nexport function getSavedFileMeta() {\n  if (isLocalStorageAvailable()) {\n    const savedFileMetaString = window.localStorage.getItem(\n      FILE_META_STORAGE_KEY\n    );\n    if (savedFileMetaString) {\n      try {\n        const savedFileMeta = JSON.parse(savedFileMetaString);\n        if (savedFileMeta.version === CURRENT_STORAGE_VERSION) {\n          return savedFileMeta.fileMeta;\n        }\n      } catch (err) {\n        // Do nothing\n      }\n    }\n  }\n\n  return {};\n}\n\nexport function saveFileMeta(fileDict) {\n  if (isLocalStorageAvailable()) {\n    window.localStorage.setItem(\n      FILE_META_STORAGE_KEY,\n      JSON.stringify({\n        version: CURRENT_STORAGE_VERSION,\n        fileMeta: Object.keys(fileDict).reduce((acc, filename) => {\n          const { objectURL, ...fileWithoutObjectURL } = fileDict[filename];\n          acc[filename] = fileWithoutObjectURL;\n\n          return acc;\n        }, {}),\n      })\n    );\n  }\n}\n"],"sourceRoot":""}